\pset border 1
\pset linestyle ascii
\set VERBOSITY terse
SET client_min_messages = INFO;
/* analyze table for reliable output */
ANALYZE typetest1;
/* default setting sometimes leads to merge joins */
SET enable_mergejoin = off;
/*
 * Cases that should be pushed down.
 */
-- inner join two tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1, typetest1  t2 WHERE t1.c = t2.c ORDER BY t1.id, t2.id;
                                                               QUERY PLAN                                                               
----------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*ea19dfccab82df8*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."C" = r2."C"))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1, typetest1  t2 WHERE t1.c = t2.c ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT length(t1.lb), length(t2.lc) FROM typetest1  t1 JOIN typetest1  t2 ON (t1.id + t2.id = 2) ORDER BY t1.id, t2.id;
                                                                            QUERY PLAN                                                                             
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*58ba0c05a8b6679c*/ r1."LB", r2."LC", r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON ((r1."ID" + r2."ID") = 2))
(4 rows)

SELECT length(t1.lb), length(t2.lc) FROM typetest1  t1 JOIN typetest1  t2 ON (t1.id + t2.id = 2) ORDER BY t1.id, t2.id;
 length | length 
--------+--------
      5 |     22
(1 row)

-- inner join two tables with ORDER BY clause, but ORDER BY does not get pushed down
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 JOIN typetest1  t2 USING (ts, num) ORDER BY t1.id, t2.id;
                                                                             QUERY PLAN                                                                              
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*805e4e34de87c3e7*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."TS" = r2."TS") AND (r1."NUM" = r2."NUM"))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 JOIN typetest1  t2 USING (ts, num) ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
(2 rows)

-- natural join two tables
EXPLAIN (COSTS off)
SELECT id FROM typetest1  NATURAL JOIN shorty  ORDER BY id;
                                                                       QUERY PLAN                                                                       
--------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: typetest1.id
   ->  Foreign Scan
         Oracle query: SELECT /*4b07a1bd1863be71*/ r1."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."ID" = r2."ID") AND (r1."C" = r2."C"))
(4 rows)

SELECT id FROM typetest1  NATURAL JOIN shorty  ORDER BY id;
 id 
----
  1
  3
  4
(3 rows)

-- table with column that does not exist in Oracle (should become NULL)
EXPLAIN (COSTS off)
SELECT t1.id, t2.x FROM typetest1  t1 JOIN longy t2  ON t1.c = t2.c ORDER BY t1.id, t2.x;
WARNING:  column number 19 of foreign table "longy" does not exist in foreign Oracle table, will be replaced by NULL
                                                           QUERY PLAN                                                           
--------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.x
   ->  Foreign Scan
         Oracle query: SELECT /*12c8fb947722e2e7*/ r1."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."C" = r2."C"))
(4 rows)

SELECT t1.id, t2.x FROM typetest1  t1 JOIN longy t2  ON t1.c = t2.c ORDER BY t1.id, t2.x;
WARNING:  column number 19 of foreign table "longy" does not exist in foreign Oracle table, will be replaced by NULL
 id | x 
----+---
  1 |  
  3 |  
  4 |  
(3 rows)

-- left outer join two tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*c70865e1f85928e*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 LEFT JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |   
(3 rows)

-- right outer join two tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
                                                               QUERY PLAN                                                               
----------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*10720d0810bb393c*/ r1."ID", r2."ID" FROM ("TYPETEST1" r2 LEFT JOIN "TYPETEST1" r1 ON (r1."D" = r2."D"))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
    |  4
(3 rows)

-- full outer join two tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
                                                               QUERY PLAN                                                               
----------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*a6d347603e1d7546*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 FULL JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |   
    |  4
(4 rows)

-- joins with filter conditions
---- inner join with WHERE clause
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*4b0f96b454d45beb*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D") AND (r1."ID" > 1))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
 id | id 
----+----
  3 |  3
(1 row)

---- left outer join with WHERE clause
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*4f21c87bd6df78c5*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 LEFT JOIN "TYPETEST1" r2 ON (r1."D" = r2."D")) WHERE (r1."ID" > 1)
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
 id | id 
----+----
  3 |  3
  4 |   
(2 rows)

---- right outer join with WHERE clause
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*4b0f96b454d45beb*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D") AND (r1."ID" > 1))
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
 id | id 
----+----
  3 |  3
(1 row)

---- full outer join with WHERE clause
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Foreign Scan
         Oracle query: SELECT /*4f21c87bd6df78c5*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 LEFT JOIN "TYPETEST1" r2 ON (r1."D" = r2."D")) WHERE (r1."ID" > 1)
(4 rows)

SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d WHERE t1.id > 1 ORDER BY t1.id, t2.id;
 id | id 
----+----
  3 |  3
  4 |   
(2 rows)

/*
 * Cases that should not be pushed down.
 */
-- join expression cannot be pushed down
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1, typetest1  t2 WHERE t1.lc = t2.lc ORDER BY t1.id, t2.id;
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (t1.lc = t2.lc)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*b19be29cfb3a87f1*/ r1."ID", r1."LC" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*f97bdee4f318a179*/ r2."ID", r2."LC" FROM "TYPETEST1" r2
(9 rows)

SELECT t1.id, t2.id FROM typetest1  t1, typetest1  t2 WHERE t1.lc = t2.lc ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |  4
(3 rows)

-- only one join condition cannot be pushed down
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 JOIN typetest1  t2 ON t1.vc = t2.vc AND t1.lb = t2.lb ORDER BY t1.id, t2.id;
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (((t1.vc)::text = (t2.vc)::text) AND (t1.lb = t2.lb))
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*36b1e7fbbe0fc9c7*/ r1."ID", r1."VC", r1."LB" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*32e6963a2663fc1f*/ r2."ID", r2."VC", r2."LB" FROM "TYPETEST1" r2
(9 rows)

SELECT t1.id, t2.id FROM typetest1  t1 JOIN typetest1  t2 ON t1.vc = t2.vc AND t1.lb = t2.lb ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |  4
(3 rows)

-- condition on one table needs to be evaluated locally
EXPLAIN (COSTS off)
SELECT max(t1.id), min(t2.id) FROM typetest1  t1 JOIN typetest1  t2 ON t1.fl = t2.fl WHERE t1.vc || 'x' = 'shortx' ORDER BY 1, 2;
                                                    QUERY PLAN                                                     
-------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: (max(t1.id)), (min(t2.id))
   ->  Aggregate
         ->  Hash Join
               Hash Cond: (t2.fl = t1.fl)
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*73944157cfb8db57*/ r2."ID", r2."FL" FROM "TYPETEST1" r2
               ->  Hash
                     ->  Foreign Scan on typetest1 t1
                           Filter: (((vc)::text || 'x'::text) = 'shortx'::text)
                           Oracle query: SELECT /*e338812309f430f9*/ r1."ID", r1."VC", r1."FL" FROM "TYPETEST1" r1
(11 rows)

SELECT max(t1.id), min(t2.id) FROM typetest1  t1 JOIN typetest1  t2 ON t1.fl = t2.fl WHERE t1.vc || 'x' = 'shortx' ORDER BY 1, 2;
 max | min 
-----+-----
   4 |   4
(1 row)

EXPLAIN (COSTS off)
SELECT t1.c, t2.nc FROM typetest1  t1 JOIN (SELECT * FROM typetest1)  t2 ON (t1.id = t2.id AND t1.c >= t2.c) ORDER BY t1.id, t2.nc;
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.nc
   ->  Hash Join
         Hash Cond: (t1.id = typetest1.id)
         Join Filter: (t1.c >= typetest1.c)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*8281e87a6daaccd5*/ r4."ID", r4."C", r4."NC" FROM "TYPETEST1" r4
(10 rows)

SELECT t1.c, t2.nc FROM typetest1  t1 JOIN (SELECT * FROM typetest1)  t2 ON (t1.id = t2.id AND t1.c >= t2.c) ORDER BY t1.id, t2.nc;
          c           |          nc          
----------------------+----------------------
 fixed chau           | nat'l char
 a\x1B\x07\r\x7Fb     | a\x1B\x07\r\x7Fb    
 short                | short     
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.c, t2.nc FROM typetest1  t1 LEFT JOIN (SELECT * FROM typetest1)  t2 ON (t1.id = t2.id AND t1.c >= t2.c) ORDER BY t1.id, t2.nc;
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.nc
   ->  Hash Left Join
         Hash Cond: (t1.id = typetest1.id)
         Join Filter: (t1.c >= typetest1.c)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*8281e87a6daaccd5*/ r4."ID", r4."C", r4."NC" FROM "TYPETEST1" r4
(10 rows)

SELECT t1.c, t2.nc FROM typetest1  t1 LEFT JOIN (SELECT * FROM typetest1)  t2 ON (t1.id = t2.id AND t1.c >= t2.c) ORDER BY t1.id, t2.nc;
          c           |          nc          
----------------------+----------------------
 fixed chau           | nat'l char
 a\x1B\x07\r\x7Fb     | a\x1B\x07\r\x7Fb    
 short                | short     
(3 rows)

-- subquery with where clause cannnot be pushed down in full outer join query
EXPLAIN (COSTS off)
SELECT t1.c, t2.nc FROM typetest1  t1 FULL JOIN (SELECT * FROM typetest1  WHERE id > 1) t2 USING (id) ORDER BY t1.id, t2.nc;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.nc
   ->  Hash Full Join
         Hash Cond: (t1.id = typetest1.id)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*4bd6464e518248ea*/ r4."ID", r4."NC" FROM "TYPETEST1" r4 WHERE (r4."ID" > 1)
(9 rows)

SELECT t1.c, t2.nc FROM typetest1  t1 FULL JOIN (SELECT * FROM typetest1  WHERE id > 1) t2 USING (id) ORDER BY t1.id, t2.nc;
          c           |          nc          
----------------------+----------------------
 fixed chau           | 
 a\x1B\x07\r\x7Fb     | a\x1B\x07\r\x7Fb    
 short                | short     
(3 rows)

-- left outer join with placeholder, not pushed down
EXPLAIN (COSTS off)
SELECT t1.id, sq1.x, sq1.y
FROM typetest1  t1 LEFT OUTER JOIN (SELECT id AS x, 99 AS y FROM typetest1  t2 WHERE id > 1) sq1 ON t1.id = sq1.x ORDER BY t1.id, sq1.x;
                                                  QUERY PLAN                                                   
---------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Left Join
         Hash Cond: (t1.id = t2.id)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*113307392b04fbaa*/ r4."ID" FROM "TYPETEST1" r4 WHERE (r4."ID" > 1)
(9 rows)

SELECT t1.id, sq1.x, sq1.y
FROM typetest1  t1 LEFT OUTER JOIN (SELECT id AS x, 99 AS y FROM typetest1  t2 WHERE id > 1) sq1 ON t1.id = sq1.x ORDER BY t1.id, sq1.x;
 id | x | y  
----+---+----
  1 |   |   
  3 | 3 | 99
  4 | 4 | 99
(3 rows)

-- inner join with placeholder, not pushed down
EXPLAIN (COSTS off)
SELECT subq2.c3
FROM typetest1
RIGHT JOIN (SELECT c AS c1 FROM typetest1)  AS subq1 ON TRUE
LEFT JOIN  (SELECT ref1.nc AS c2, 10 AS c3 FROM typetest1  AS ref1
            INNER JOIN typetest1  AS ref2 ON ref1.fl = ref2.fl) AS subq2
ON subq1.c1 = subq2.c2 ORDER BY subq2.c3;
                                                                     QUERY PLAN                                                                     
----------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: (10)
   ->  Nested Loop Left Join
         ->  Hash Left Join
               Hash Cond: (typetest1_1.c = ref1.nc)
               ->  Foreign Scan on typetest1 typetest1_1
                     Oracle query: SELECT /*4a3a4f3451e622ac*/ r6."C" FROM "TYPETEST1" r6
               ->  Hash
                     ->  Foreign Scan
                           Oracle query: SELECT /*d2eb37bf5f88efe4*/ r7."NC" FROM ("TYPETEST1" r7 INNER JOIN "TYPETEST1" r8 ON (r7."FL" = r8."FL"))
         ->  Materialize
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*5ac4525c1631b53c*/ '1' FROM "TYPETEST1" r1
(13 rows)

SELECT subq2.c3
FROM typetest1
RIGHT JOIN (SELECT c AS c1 FROM typetest1)  AS subq1 ON TRUE
LEFT JOIN  (SELECT ref1.nc AS c2, 10 AS c3 FROM typetest1  AS ref1
            INNER JOIN typetest1  AS ref2 ON ref1.fl = ref2.fl) AS subq2
ON subq1.c1 = subq2.c2 ORDER BY subq2.c3;
 c3 
----
 10
 10
 10
 10
 10
 10
   
   
   
(9 rows)

-- inner rel is false, not pushed down
EXPLAIN (COSTS off)
SELECT 1 FROM (SELECT 1 FROM typetest1  WHERE false) AS subq1 RIGHT JOIN typetest1  AS ref1 ON NULL ORDER BY ref1.id;
                                                  QUERY PLAN                                                   
---------------------------------------------------------------------------------------------------------------
 Nested Loop Left Join
   Join Filter: (false AND NULL::boolean)
   ->  Foreign Scan on typetest1 ref1
         Oracle query: SELECT /*5d60d3afb74ea0b8*/ r2."ID" FROM "TYPETEST1" r2 ORDER BY r2."ID" ASC NULLS LAST
   ->  Result
         One-Time Filter: false
(6 rows)

SELECT 1 FROM (SELECT 1 FROM typetest1  WHERE false) AS subq1 RIGHT JOIN typetest1  AS ref1 ON NULL ORDER BY ref1.id;
 ?column? 
----------
        1
        1
        1
(3 rows)

-- semi-join, not pushed down
EXPLAIN (COSTS off)
SELECT t1.id FROM typetest1  t1 WHERE EXISTS (SELECT 1 FROM typetest1  t2 WHERE t1.d = t2.d) ORDER BY t1.id;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Nested Loop Semi Join
   Join Filter: (t1.d = t2.d)
   ->  Foreign Scan on typetest1 t1
         Oracle query: SELECT /*722ea528526f9891*/ r1."ID", r1."D" FROM "TYPETEST1" r1 ORDER BY r1."ID" ASC NULLS LAST
   ->  Materialize
         ->  Foreign Scan on typetest1 t2
               Oracle query: SELECT /*dc521fd7d7e55464*/ r2."D" FROM "TYPETEST1" r2
(7 rows)

SELECT t1.id FROM typetest1  t1 WHERE EXISTS (SELECT 1 FROM typetest1  t2 WHERE t1.d = t2.d) ORDER BY t1.id;
 id 
----
  1
  3
(2 rows)

-- anti-join, not pushed down
EXPLAIN (COSTS off)
SELECT t1.id FROM typetest1  t1 WHERE NOT EXISTS (SELECT 1 FROM typetest1  t2 WHERE t1.d = t2.d) ORDER BY t1.id;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Nested Loop Anti Join
   Join Filter: (t1.d = t2.d)
   ->  Foreign Scan on typetest1 t1
         Oracle query: SELECT /*722ea528526f9891*/ r1."ID", r1."D" FROM "TYPETEST1" r1 ORDER BY r1."ID" ASC NULLS LAST
   ->  Materialize
         ->  Foreign Scan on typetest1 t2
               Oracle query: SELECT /*dc521fd7d7e55464*/ r2."D" FROM "TYPETEST1" r2
(7 rows)

SELECT t1.id FROM typetest1  t1 WHERE NOT EXISTS (SELECT 1 FROM typetest1  t2 WHERE t1.d = t2.d) ORDER BY t1.id;
 id 
----
  4
(1 row)

-- cross join, not pushed down
EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 CROSS JOIN typetest1  t2 ORDER BY t1.id, t2.id;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Nested Loop
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(8 rows)

SELECT t1.id, t2.id FROM typetest1  t1 CROSS JOIN typetest1  t2 ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  1 |  3
  1 |  4
  3 |  1
  3 |  3
  3 |  4
  4 |  1
  4 |  3
  4 |  4
(9 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Nested Loop
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(8 rows)

SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  1 |  3
  1 |  4
  3 |  1
  3 |  3
  3 |  4
  4 |  1
  4 |  3
  4 |  4
(9 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Nested Loop Left Join
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(8 rows)

SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  1 |  3
  1 |  4
  3 |  1
  3 |  3
  3 |  4
  4 |  1
  4 |  3
  4 |  4
(9 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Nested Loop Left Join
         ->  Foreign Scan on typetest1 t2
               Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
         ->  Materialize
               ->  Foreign Scan on typetest1 t1
                     Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
(8 rows)

SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  1 |  3
  1 |  4
  3 |  1
  3 |  3
  3 |  4
  4 |  1
  4 |  3
  4 |  4
(9 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Sort
   Disabled Nodes: 1
   Sort Key: t1.id, t2.id
   ->  Merge Full Join
         Disabled Nodes: 1
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(10 rows)

SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  1
  1 |  3
  1 |  4
  3 |  1
  3 |  3
  3 |  4
  4 |  1
  4 |  3
  4 |  4
(9 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 CROSS JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ORDER BY t1.id, t2.id;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.id
   ->  Nested Loop
         ->  Foreign Scan on typetest1
               Oracle query: SELECT /*ac186001cd96ffc9*/ r4."ID", r4."VC" FROM "TYPETEST1" r4 WHERE (r4."VC" = 'short')
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
(7 rows)

SELECT t1.id, t2.id FROM typetest1  t1 CROSS JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  4
  3 |  4
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.id
   ->  Nested Loop
         ->  Foreign Scan on typetest1
               Oracle query: SELECT /*ac186001cd96ffc9*/ r4."ID", r4."VC" FROM "TYPETEST1" r4 WHERE (r4."VC" = 'short')
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
(7 rows)

SELECT t1.id, t2.id FROM typetest1  t1 INNER JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  4
  3 |  4
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
                                                          QUERY PLAN                                                          
------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.id
   ->  Nested Loop Left Join
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*ac186001cd96ffc9*/ r4."ID", r4."VC" FROM "TYPETEST1" r4 WHERE (r4."VC" = 'short')
(8 rows)

SELECT t1.id, t2.id FROM typetest1  t1 LEFT  JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  4
  3 |  4
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, typetest1.id
   ->  Nested Loop Left Join
         ->  Foreign Scan on typetest1
               Oracle query: SELECT /*ac186001cd96ffc9*/ r4."ID", r4."VC" FROM "TYPETEST1" r4 WHERE (r4."VC" = 'short')
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
(7 rows)

SELECT t1.id, t2.id FROM typetest1  t1 RIGHT JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  4
  3 |  4
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
                                                          QUERY PLAN                                                          
------------------------------------------------------------------------------------------------------------------------------
 Sort
   Disabled Nodes: 1
   Sort Key: t1.id, typetest1.id
   ->  Merge Full Join
         Disabled Nodes: 1
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*f9bcb8b1884a883a*/ r1."ID" FROM "TYPETEST1" r1
         ->  Materialize
               ->  Foreign Scan on typetest1
                     Oracle query: SELECT /*ac186001cd96ffc9*/ r4."ID", r4."VC" FROM "TYPETEST1" r4 WHERE (r4."VC" = 'short')
(10 rows)

SELECT t1.id, t2.id FROM typetest1  t1 FULL  JOIN (SELECT * FROM typetest1  WHERE vc = 'short') t2 ON true ORDER BY t1.id, t2.id;
 id | id 
----+----
  1 |  4
  3 |  4
  4 |  4
(3 rows)

-- update statement, not pushed down
EXPLAIN (COSTS off) UPDATE typetest1 t1 SET c = NULL FROM typetest1 t2 WHERE t1.vc = t2.vc AND t2.num = 3.14159;
                                                                                                                                  QUERY PLAN                                                                                                                                  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Update on typetest1 t1
   Oracle statement: UPDATE "TYPETEST1" SET "C" = :p3 WHERE "ID" = :k1
   ->  Hash Join
         Hash Cond: ((t1.vc)::text = (t2.vc)::text)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*c1ce793ab752187b*/ r1."ID", r1."C", r1."NC", r1."VC", r1."NVC", r1."LC", r1."R", r1."U", r1."LB", r1."LR", r1."B", r1."NUM", r1."FL", r1."DB", r1."D", r1."TS", r1."IDS", r1."IYM" FROM "TYPETEST1" r1 FOR UPDATE
         ->  Hash
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*5524a3d88704cd21*/ r2."ID", r2."C", r2."NC", r2."VC", r2."NVC", r2."LC", r2."R", r2."U", r2."LB", r2."LR", r2."B", r2."NUM", r2."FL", r2."DB", r2."D", r2."TS", r2."IDS", r2."IYM" FROM "TYPETEST1" r2 WHERE (r2."NUM" = 3.14159)
(9 rows)

-- join with FOR UPDATE, not pushed down
EXPLAIN (COSTS off) SELECT t1.id FROM typetest1 t1, typetest1 t2 WHERE t1.id = t2.id FOR UPDATE;
                                                                                                                          QUERY PLAN                                                                                                                          
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 LockRows
   ->  Hash Join
         Hash Cond: (t1.id = t2.id)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*c1ce793ab752187b*/ r1."ID", r1."C", r1."NC", r1."VC", r1."NVC", r1."LC", r1."R", r1."U", r1."LB", r1."LR", r1."B", r1."NUM", r1."FL", r1."DB", r1."D", r1."TS", r1."IDS", r1."IYM" FROM "TYPETEST1" r1 FOR UPDATE
         ->  Hash
               ->  Foreign Scan on typetest1 t2
                     Oracle query: SELECT /*37932a36ac6a193e*/ r2."ID", r2."C", r2."NC", r2."VC", r2."NVC", r2."LC", r2."R", r2."U", r2."LB", r2."LR", r2."B", r2."NUM", r2."FL", r2."DB", r2."D", r2."TS", r2."IDS", r2."IYM" FROM "TYPETEST1" r2 FOR UPDATE
(8 rows)

-- join in CTE
WITH t (t1_id, t2_id) AS (SELECT t1.id, t2.id FROM typetest1  t1 JOIN typetest1  t2 ON t1.d = t2.d) SELECT t1_id, t2_id FROM t ORDER BY t1_id, t2_id;
 t1_id | t2_id 
-------+-------
     1 |     1
     3 |     3
(2 rows)

-- whole-row and system columns, not pushed down
EXPLAIN (COSTS off)
SELECT t1, t1.ctid FROM shorty t1 INNER JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Nested Loop
   Join Filter: (t1.id = t2.id)
   ->  Foreign Scan on shorty t1
         Oracle query: SELECT /*70f4d4d40cda0863*/ r1."ID", r1."C" FROM "TYPETEST1" r1 ORDER BY r1."ID" ASC NULLS LAST
   ->  Materialize
         ->  Foreign Scan on longy t2
               Oracle query: SELECT /*5d60d3afb74ea0b8*/ r2."ID" FROM "TYPETEST1" r2 ORDER BY r2."ID" ASC NULLS LAST
(7 rows)

SELECT t1, t1.ctid FROM shorty t1 INNER JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
             t1             |      ctid      
----------------------------+----------------
 (1,"fixed chau")           | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
(3 rows)

EXPLAIN (COSTS off)
SELECT t1, t1.ctid FROM shorty t1 LEFT  JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Nested Loop Left Join
   Join Filter: (t1.id = t2.id)
   ->  Foreign Scan on shorty t1
         Oracle query: SELECT /*70f4d4d40cda0863*/ r1."ID", r1."C" FROM "TYPETEST1" r1 ORDER BY r1."ID" ASC NULLS LAST
   ->  Materialize
         ->  Foreign Scan on longy t2
               Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(7 rows)

SELECT t1, t1.ctid FROM shorty t1 LEFT  JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
             t1             |      ctid      
----------------------------+----------------
 (1,"fixed chau")           | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
(3 rows)

EXPLAIN (COSTS off)
SELECT t1, t1.ctid FROM shorty t1 RIGHT JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id
   ->  Hash Left Join
         Hash Cond: (t2.id = t1.id)
         ->  Foreign Scan on longy t2
               Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
         ->  Hash
               ->  Foreign Scan on shorty t1
                     Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
(9 rows)

SELECT t1, t1.ctid FROM shorty t1 RIGHT JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
             t1             |      ctid      
----------------------------+----------------
 (1,"fixed chau")           | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
(3 rows)

EXPLAIN (COSTS off)
SELECT t1, t1.ctid FROM shorty t1 FULL  JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
                                         QUERY PLAN                                          
---------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id
   ->  Hash Full Join
         Hash Cond: (t1.id = t2.id)
         ->  Foreign Scan on shorty t1
               Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan on longy t2
                     Oracle query: SELECT /*4f4c2f8a10477927*/ r2."ID" FROM "TYPETEST1" r2
(9 rows)

SELECT t1, t1.ctid FROM shorty t1 FULL  JOIN longy t2 ON t1.id = t2.id ORDER BY t1.id;
             t1             |      ctid      
----------------------------+----------------
 (1,"fixed chau")           | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
(3 rows)

EXPLAIN (COSTS off)
SELECT t1, t1.ctid FROM shorty t1 CROSS JOIN longy t2 ORDER BY t1.id;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Nested Loop
   ->  Foreign Scan on shorty t1
         Oracle query: SELECT /*70f4d4d40cda0863*/ r1."ID", r1."C" FROM "TYPETEST1" r1 ORDER BY r1."ID" ASC NULLS LAST
   ->  Materialize
         ->  Foreign Scan on longy t2
               Oracle query: SELECT /*311308f216f42136*/ '1' FROM "TYPETEST1" r2
(6 rows)

SELECT t1, t1.ctid FROM shorty t1 CROSS JOIN longy t2 ORDER BY t1.id;
             t1             |      ctid      
----------------------------+----------------
 (1,"fixed chau")           | (4294967295,0)
 (1,"fixed chau")           | (4294967295,0)
 (1,"fixed chau")           | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (3,"a\x1B\x07\r\x7Fb    ") | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
 (4,"short     ")           | (4294967295,0)
(9 rows)

-- only part of a three-way join will be pushed down
---- inner join three tables
EXPLAIN (COSTS off)
SELECT t1.id, t3.id FROM typetest1  t1 JOIN typetest1  t2 USING (nvc) JOIN typetest1  t3 ON t2.db = t3.db ORDER BY t1.id, t3.id;
                                                                    QUERY PLAN                                                                     
---------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t3.id
   ->  Hash Join
         Hash Cond: (t2.db = t3.db)
         ->  Foreign Scan
               Oracle query: SELECT /*fbdeb0ca1f705712*/ r1."ID", r2."DB" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."NVC" = r2."NVC"))
         ->  Hash
               ->  Foreign Scan on typetest1 t3
                     Oracle query: SELECT /*1d11d7a1af28e194*/ r4."ID", r4."DB" FROM "TYPETEST1" r4
(9 rows)

SELECT t1.id, t3.id FROM typetest1  t1 JOIN typetest1  t2 USING (nvc) JOIN typetest1  t3 ON t2.db = t3.db ORDER BY t1.id, t3.id;
 id | id 
----+----
  1 |  1
  3 |  3
  4 |  4
(3 rows)

EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                             QUERY PLAN                                                                              
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (t3.d = t1.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*970b3d64988ffba0*/ r1."ID", r1."D", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
(2 rows)

---- inner outer join + left outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*dd30242bbb48b21c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
(2 rows)

---- inner outer join + right outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Left Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*dd30242bbb48b21c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |    |  4
(3 rows)

---- inner outer join + full outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Full Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*dd30242bbb48b21c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 INNER JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |    |  4
(3 rows)

---- left outer join three tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*79165c6ce968f9c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 LEFT JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
  4 |    |   
(3 rows)

---- left outer join + inner outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                             QUERY PLAN                                                                              
---------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (t3.d = t1.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*970b3d64988ffba0*/ r1."ID", r1."D", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
(2 rows)

---- left outer join + right outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Left Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*dd30242bbb48b21c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |    |  4
(3 rows)

---- left outer join + full outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                        QUERY PLAN                                                                         
-----------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Full Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*79165c6ce968f9c*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 LEFT JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 LEFT  JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
  4 |    |   
    |    |  4
(4 rows)

---- right outer join three tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t1.d = t2.d)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*6d7e2bb5d74b6fd4*/ r1."ID", r1."D" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*2c42be93566afa20*/ r4."ID", r2."ID", r2."D" FROM ("TYPETEST1" r4 LEFT JOIN "TYPETEST1" r2 ON (r2."D" = r4."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |    |  4
(3 rows)

---- right outer join + inner outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*e30c1697bf3fdfbc*/ r2."ID", r2."D", r1."ID" FROM ("TYPETEST1" r2 LEFT JOIN "TYPETEST1" r1 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
(2 rows)

---- right outer join + left outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*e30c1697bf3fdfbc*/ r2."ID", r2."D", r1."ID" FROM ("TYPETEST1" r2 LEFT JOIN "TYPETEST1" r1 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |  4 |   
(3 rows)

---- right outer join + full outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Full Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*e30c1697bf3fdfbc*/ r2."ID", r2."D", r1."ID" FROM ("TYPETEST1" r2 LEFT JOIN "TYPETEST1" r1 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 RIGHT JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |  4 |   
    |    |  4
(4 rows)

---- full outer join three tables
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Full Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*3ae35d616eafb666*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 FULL JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d FULL  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
  4 |    |   
    |  4 |   
    |    |  4
(5 rows)

---- full outer join + inner join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*e30c1697bf3fdfbc*/ r2."ID", r2."D", r1."ID" FROM ("TYPETEST1" r2 LEFT JOIN "TYPETEST1" r1 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d INNER JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
(2 rows)

---- full outer join + left outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t3.d = t2.d)
         ->  Foreign Scan on typetest1 t3
               Oracle query: SELECT /*f53570eb81e9846a*/ r4."ID", r4."D" FROM "TYPETEST1" r4
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*3ae35d616eafb666*/ r1."ID", r2."ID", r2."D" FROM ("TYPETEST1" r1 FULL JOIN "TYPETEST1" r2 ON (r1."D" = r2."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d LEFT  JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
  4 |    |   
    |  4 |   
(4 rows)

---- full outer join + right outer join
EXPLAIN (COSTS off)
SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, t2.id
   ->  Hash Right Join
         Hash Cond: (t1.d = t2.d)
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*6d7e2bb5d74b6fd4*/ r1."ID", r1."D" FROM "TYPETEST1" r1
         ->  Hash
               ->  Foreign Scan
                     Oracle query: SELECT /*2c42be93566afa20*/ r4."ID", r2."ID", r2."D" FROM ("TYPETEST1" r4 LEFT JOIN "TYPETEST1" r2 ON (r2."D" = r4."D"))
(9 rows)

SELECT t1.id, t2.id, t3.id FROM typetest1  t1 FULL  JOIN typetest1  t2 ON t1.d = t2.d RIGHT JOIN typetest1  t3 ON t2.d = t3.d ORDER BY t1.id, t2.id;
 id | id | id 
----+----+----
  1 |  1 |  1
  3 |  3 |  3
    |    |  4
(3 rows)

-- join with LATERAL reference
EXPLAIN (COSTS off)
SELECT t1.id, sl.c FROM typetest1  t1, LATERAL (SELECT DISTINCT s.c FROM shorty s,   longy l WHERE s.id = l.id AND l.c = t1.c) sl ORDER BY t1.id, sl.c;
                                                                              QUERY PLAN                                                                              
----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t1.id, s.c
   ->  Nested Loop
         ->  Foreign Scan on typetest1 t1
               Oracle query: SELECT /*92c465781c2259ec*/ r1."ID", r1."C" FROM "TYPETEST1" r1
         ->  Unique
               ->  Sort
                     Sort Key: s.c
                     ->  Foreign Scan
                           Oracle query: SELECT /*eb88aafbc3c8aea1*/ r1."C" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."ID" = r2."ID") AND (r2."C" = :p1))
(10 rows)

SELECT t1.id, sl.c FROM typetest1  t1, LATERAL (SELECT DISTINCT s.c FROM shorty s,   longy l WHERE s.id = l.id AND l.c = t1.c) sl ORDER BY t1.id, sl.c;
 id |          c           
----+----------------------
  1 | fixed chau
  3 | a\x1B\x07\r\x7Fb    
  4 | short     
(3 rows)

-- test for bug #279 fixed with 839b125e1bdc63b71220ccd675fa852c028de9ea
SELECT 1
FROM typetest1 a
   LEFT JOIN typetest1 b ON (a.id IS NOT NULL)
WHERE (a.c = a.vc) = (b.id IS NOT NULL);
 ?column? 
----------
        1
        1
        1
        1
        1
        1
(6 rows)

/*
 * Cost estimates.
 */
-- gather statistics
ANALYZE typetest1;
-- costs with statistics
EXPLAIN SELECT t1.id, t2.id FROM typetest1 t1, typetest1 t2 WHERE t1.c = t2.c;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Foreign Scan  (cost=10000.00..10030.00 rows=3 width=8)
   Oracle query: SELECT /*ea19dfccab82df8*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."C" = r2."C"))
(2 rows)

EXPLAIN SELECT t1.id, t2.id FROM typetest1 t1, typetest1 t2 WHERE t1.c <> t2.c;
                                                             QUERY PLAN                                                             
------------------------------------------------------------------------------------------------------------------------------------
 Foreign Scan  (cost=10000.00..10060.00 rows=6 width=8)
   Oracle query: SELECT /*9564dc36650a4136*/ r1."ID", r2."ID" FROM ("TYPETEST1" r1 INNER JOIN "TYPETEST1" r2 ON (r1."C" <> r2."C"))
(2 rows)

